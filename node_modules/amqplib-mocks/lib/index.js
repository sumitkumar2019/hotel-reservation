"use strict";

const sinon = require("sinon");
const Connection = require("./connection");

class ConnectionManager {
	constructor() {
		this.connections = {};

		this.connect = sinon.stub().callsFake(url => {
			if (this.connections[url]) {
				const err = new Error(`A connection is already open to ${url}`);
				return Promise.reject(err);
			}

			const connection = new Connection(() => {
				delete this.connections[url];
			});
			this.connections[url] = connection;
			return Promise.resolve(connection);
		});
	}

	getConnection(url) {
		return this.connections[url];
	}

	reset() {
		this.connect.resetHistory();
		this.connections = {};
	}
}

const instance = new ConnectionManager();

module.exports = instance;
module.exports.ConnectionManager = ConnectionManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJzaW5vbiIsInJlcXVpcmUiLCJDb25uZWN0aW9uIiwiQ29ubmVjdGlvbk1hbmFnZXIiLCJjb25zdHJ1Y3RvciIsImNvbm5lY3Rpb25zIiwiY29ubmVjdCIsInN0dWIiLCJjYWxsc0Zha2UiLCJ1cmwiLCJlcnIiLCJFcnJvciIsIlByb21pc2UiLCJyZWplY3QiLCJjb25uZWN0aW9uIiwicmVzb2x2ZSIsImdldENvbm5lY3Rpb24iLCJyZXNldCIsInJlc2V0SGlzdG9yeSIsImluc3RhbmNlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNQSxRQUFRQyxRQUFTLE9BQVQsQ0FBZDtBQUNBLE1BQU1DLGFBQWFELFFBQVMsY0FBVCxDQUFuQjs7QUFFQSxNQUFNRSxpQkFBTixDQUF3QjtBQUN2QkMsZUFBYztBQUNiLE9BQUtDLFdBQUwsR0FBbUIsRUFBbkI7O0FBRUEsT0FBS0MsT0FBTCxHQUFlTixNQUFNTyxJQUFOLEdBQWFDLFNBQWIsQ0FBd0JDLE9BQU87QUFDN0MsT0FBSyxLQUFLSixXQUFMLENBQWtCSSxHQUFsQixDQUFMLEVBQStCO0FBQzlCLFVBQU1DLE1BQU0sSUFBSUMsS0FBSixDQUFZLG1DQUFtQ0YsR0FBSyxFQUFwRCxDQUFaO0FBQ0EsV0FBT0csUUFBUUMsTUFBUixDQUFnQkgsR0FBaEIsQ0FBUDtBQUNBOztBQUVELFNBQU1JLGFBQWEsSUFBSVosVUFBSixDQUFnQixNQUFNO0FBQ3hDLFdBQU8sS0FBS0csV0FBTCxDQUFrQkksR0FBbEIsQ0FBUDtBQUNBLElBRmtCLENBQW5CO0FBR0EsUUFBS0osV0FBTCxDQUFrQkksR0FBbEIsSUFBMEJLLFVBQTFCO0FBQ0EsVUFBT0YsUUFBUUcsT0FBUixDQUFpQkQsVUFBakIsQ0FBUDtBQUNBLEdBWGMsQ0FBZjtBQVlBOztBQUVERSxlQUFlUCxHQUFmLEVBQXFCO0FBQ3BCLFNBQU8sS0FBS0osV0FBTCxDQUFrQkksR0FBbEIsQ0FBUDtBQUNBOztBQUVEUSxTQUFRO0FBQ1AsT0FBS1gsT0FBTCxDQUFhWSxZQUFiO0FBQ0EsT0FBS2IsV0FBTCxHQUFtQixFQUFuQjtBQUNBO0FBekJzQjs7QUE0QnhCLE1BQU1jLFdBQVcsSUFBSWhCLGlCQUFKLEVBQWpCOztBQUVBaUIsT0FBT0MsT0FBUCxHQUFpQkYsUUFBakI7QUFDQUMsT0FBT0MsT0FBUCxDQUFlbEIsaUJBQWYsR0FBbUNBLGlCQUFuQyIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNpbm9uID0gcmVxdWlyZSggXCJzaW5vblwiICk7XG5jb25zdCBDb25uZWN0aW9uID0gcmVxdWlyZSggXCIuL2Nvbm5lY3Rpb25cIiApO1xuXG5jbGFzcyBDb25uZWN0aW9uTWFuYWdlciB7XG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdHRoaXMuY29ubmVjdGlvbnMgPSB7fTtcblxuXHRcdHRoaXMuY29ubmVjdCA9IHNpbm9uLnN0dWIoKS5jYWxsc0Zha2UoIHVybCA9PiB7XG5cdFx0XHRpZiAoIHRoaXMuY29ubmVjdGlvbnNbIHVybCBdICkge1xuXHRcdFx0XHRjb25zdCBlcnIgPSBuZXcgRXJyb3IoIGBBIGNvbm5lY3Rpb24gaXMgYWxyZWFkeSBvcGVuIHRvICR7IHVybCB9YCApO1xuXHRcdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoIGVyciApO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBjb25uZWN0aW9uID0gbmV3IENvbm5lY3Rpb24oICgpID0+IHtcblx0XHRcdFx0ZGVsZXRlIHRoaXMuY29ubmVjdGlvbnNbIHVybCBdO1xuXHRcdFx0fSApO1xuXHRcdFx0dGhpcy5jb25uZWN0aW9uc1sgdXJsIF0gPSBjb25uZWN0aW9uO1xuXHRcdFx0cmV0dXJuIFByb21pc2UucmVzb2x2ZSggY29ubmVjdGlvbiApO1xuXHRcdH0gKTtcblx0fVxuXG5cdGdldENvbm5lY3Rpb24oIHVybCApIHtcblx0XHRyZXR1cm4gdGhpcy5jb25uZWN0aW9uc1sgdXJsIF07XG5cdH1cblxuXHRyZXNldCgpIHtcblx0XHR0aGlzLmNvbm5lY3QucmVzZXRIaXN0b3J5KCk7XG5cdFx0dGhpcy5jb25uZWN0aW9ucyA9IHt9O1xuXHR9XG59XG5cbmNvbnN0IGluc3RhbmNlID0gbmV3IENvbm5lY3Rpb25NYW5hZ2VyKCk7XG5cbm1vZHVsZS5leHBvcnRzID0gaW5zdGFuY2U7XG5tb2R1bGUuZXhwb3J0cy5Db25uZWN0aW9uTWFuYWdlciA9IENvbm5lY3Rpb25NYW5hZ2VyO1xuIl19